#!/usr/bin/env node

var program = require('commander');
var _ = require('lodash');
var assert = require('assert');
var JSONStream = require("json-stream");

// Get command line arguments, now is form standard input & elasticsearch is local.
// So, these parameters are useless now
program.version('0.1.0')
  .option('-H, --host <Elastic Host>', 'Specify Elasticsearch host and port, default: localhost:9200', 'localhost:9200')
  .option('-D, --debug', 'Enable Debugging')
  .option('-t, --type <Elastic type>', 'Specify type')
  .option('--api <version>', 'Specify Elasticsearch API version, such as, 1.1, 1.2, 1.3, default: 1.4.', '1.4')
  .parse(process.argv);

var esLogLevel = 'warning';
if (program.debug) {
  var Debug = require('debug');
  Debug.enable('elasticwrite-pipe:debug');
  esLogLevel = 'debug';
}

// get the objects
var LambdaUtil = require('../lambda-util');
var stream = JSONStream();

var stringline = new LambdaUtil.StringLine();
var elasticwrite = new LambdaUtil.ElasticNewPipe();

// use pipe deal with the data from standard in
process.stdin
  .pipe(stream)
  .pipe(stringline)
  .pipe(elasticwrite);
